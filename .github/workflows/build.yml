name: Emacs on windows dotfile building
run-name: ${{ github.actor }} is build and packaging Emacs dotfiles üöÄ
on: [push]
jobs:
  emacs-dotfile-build:
    runs-on: windows-latest
    steps:
      # - name: Check out repository code
      #   uses: actions/checkout@v3
      - name: Download Emacs binary and uncompress it.
        run: |
          curl -LO https://github.com/kiennq/emacs-build/releases/download/v30.172.20230101.8aae5fb/emacs-master-x86_64-full.zip;
          unzip emacs-master-x86_64-full.zip -d emacs-bin;
      - name: Fetch Emacs version
        run: |
          $Env:Path += ";${{ github.workspace }}\emacs-bin\bin";
          echo $(& emacs --version);
      - name: Clone my doom emacs configuration
        run: |
          git clone --depth 1 https://github.com/doomemacs/doomemacs.git $HOME\.emacs.d;
          git clone https://github.com/MoozIiSP/doom-emacs-private.git $HOME\.doom.d;
      - name: configure ~/.emacs.d/bin/doom
        run: |
          $Env:Path += ";${{ github.workspace }}\emacs-bin\bin";
          $Env:Path += ";$HOME\.emacs.d\bin";
          & doom install --no-env;
      - name: packaging
        run: |
          cd $HOME;
          tar czf doomemacs-dotfiles-cache.tgz .emacs.d .doom.d;
          mv doomemacs-dotfiles-cache.tgz ${{ github.workspace }}\doomemacs-dotfiles-cache.tgz;
      - name: Upload doomemacs-dotfiles-cache.tgz
        uses: actions/upload-artifact@v3
        with:
          name: doomemacs-dotfiles
          path: ${{ github.workspace }}\doomemacs-dotfiles-cache.tgz
      - run: echo "üçè This job's status is ${{ job.status }}."